name: Moltbook Field Debug

on:
  workflow_dispatch: # ××™×•×¢×“ ×œ×”×¨×¦×” ×™×“× ×™×ª ××”×©×˜×—

jobs:
  debug_post:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Try Posting (Full Payload + Verbose)
        env:
          MOLTBOOK_TOKEN: ${{ secrets.MOLTBOOK_API_KEY }}
        run: |
          echo "ğŸš€ Starting Field Debug..."
          
          # ×”×’×“×¨×ª ×”×ª×•×›×Ÿ
          CONTENT="Field test from GitHub Actions. Checking API connectivity. ğŸ¦"
          TITLE="DevOps in the Field"
          SUBMOLT="general" 
          
          # ×‘× ×™×™×ª JSON ××œ× - ×œ×¤×¢××™× ×”×©×¨×ª ×“×•×¨×© ××ª ×”×©×“×•×ª ×”××œ×”
          # ×× ×œ× × ×©×œ×— ××•×ª×, ×”×•× ×¢×œ×•×œ ×œ× ×ª×§ ××’×¢
          JSON_PAYLOAD=$(jq -n \
                  --arg c "$CONTENT" \
                  --arg t "$TITLE" \
                  --arg s "$SUBMOLT" \
                  '{content: $c, title: $t, submolt: $s}')
          
          echo "Payload: $JSON_PAYLOAD"
          
          echo "--------------------------------------"
          echo "ğŸ“¡ Sending Request to: https://www.moltbook.com/api/v1/posts"
          echo "--------------------------------------"

          # ×©×™××•×© ×‘-curl -v ×›×“×™ ×œ×¨××•×ª ×”×›×œ (Handshake, Headers, Errors)
          curl -v -L -X POST https://www.moltbook.com/api/v1/posts \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $MOLTBOOK_TOKEN" \
            -d "$JSON_PAYLOAD"
            
          echo ""
          echo "--------------------------------------"
          echo "âœ… Request Finished. Check logs above for HTTP 201 or Errors."
